<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MemeXðŸ˜Š Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Existing styles remain unchanged */
    </style>
</head>
<body>
    <div class="container">
        <h1>MemeXðŸ˜Š Dashboard</h1>
        <div class="dashboard">
            <div class="filters">
                <button onclick="filterWithdrawals('daily', this)">GÃ¼nlÃ¼k</button>
                <button onclick="filterWithdrawals('weekly', this)">HaftalÄ±k</button>
                <button onclick="filterWithdrawals('monthly', this)">AylÄ±k</button>
                <button onclick="filterWithdrawals('all', this)">TÃ¼mÃ¼</button>
                <button onclick="filterValidWallets(this)">GeÃ§erli CÃ¼zdan</button>
                <button onclick="downloadData()">Veriyi Ä°ndir</button>
            </div>
            <div class="summary-cards">
                <div class="card">
                    <h3 id="total-withdrawals">0</h3>
                    <p>Toplam Ã‡ekim</p>
                </div>
                <div class="card">
                    <h3 id="total-amount">0</h3>
                    <p>Toplam Ã‡ekilen Miktar</p>
                </div>
                <div class="card">
                    <h3 id="valid-count">0</h3>
                    <p>BaÅŸlayan Ã‡ekim Adeti</p>
                </div>
                <div class="card">
                    <h3 id="valid-total-amount">0</h3>
                    <p>BaÅŸlayan Ã‡ekim MiktarÄ±</p>
                </div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th onclick="sortTable('recipient')">CÃ¼zdan Adresi</th>
                        <th onclick="sortTable('amount')">Miktar</th>
                        <th onclick="sortTable('timestamp')">Tarih</th>
                    </tr>
                </thead>
                <tbody id="withdrawal-table-body">
                </tbody>
            </table>
        </div>
    </div>
    <script>
        let withdrawals = [];
        let filteredWithdrawals = [];
        let sortOrder = { recipient: true, amount: true, timestamp: true };
        let activeFilters = { validWallet: false, period: 'all' };

        async function fetchData() {
            try {
                const response = await fetch('/api/withdrawals');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                withdrawals = data.map(w => ({
                    recipient: w.walletAddress || 'N/A',
                    amount: w.amount,
                    timestamp: new Date(w.timestamp),
                }));
                filteredWithdrawals = [...withdrawals];
                renderSummary();
                renderWithdrawals();
            } catch (error) {
                console.error('Error fetching data:', error);
                alert('Veri yÃ¼klenirken bir hata oluÅŸtu. LÃ¼tfen sayfayÄ± yenileyin.');
            }
        }

        // Existing functions remain unchanged
        function renderSummary() {
            const totalWithdrawals = filteredWithdrawals.length;
            const totalAmount = filteredWithdrawals.reduce((sum, w) => sum + w.amount, 0);
            const validWithdrawals = filteredWithdrawals.filter(w => w.recipient.startsWith('x'));
            const validCount = validWithdrawals.length;
            const validTotalAmount = validWithdrawals.reduce((sum, w) => sum + w.amount, 0);

            document.getElementById("total-withdrawals").textContent = totalWithdrawals;
            document.getElementById("total-amount").textContent = totalAmount;
            document.getElementById("valid-count").textContent = validCount;
            document.getElementById("valid-total-amount").textContent = validTotalAmount;
        }

        function renderWithdrawals() {
            const tableBody = document.getElementById("withdrawal-table-body");
            tableBody.innerHTML = '';
            filteredWithdrawals.forEach(w => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${w.recipient}</td>
                    <td>${w.amount}</td>
                    <td>${w.timestamp.toLocaleString()}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Initialize data fetch when page loads
        document.addEventListener("DOMContentLoaded", fetchData);
    </script>
</body>
</html>